const g="hp-";var f={debounce(n,t=0){let o=null;return function(){const r=()=>n.apply(this,arguments);o&&clearTimeout(o),o=setTimeout(r,t)}},getShadow(n){const t=document.createElement("div");return t.innerHTML=n,t},addId(n){const t=[...n.attributes].find(c=>c.name.startsWith(g));if(t)return t.name.replace(g,"");const o=Date.now(),r=Math.round(Math.random()*(9999999999999-o)+o).toString(36);return n.setAttribute(`${g}${r}`,""),r},wrap(n){const t=document.createElement("span"),o=this.addId(t);return n.parentNode.insertBefore(t,n),t.append(n),o},findId(n,t,o=!0){const r=`[${g}${t}]`;return o?n.querySelector(r):n.querySelectorAll(r)}},E={create(n,t){let o=[];const r=f.debounce(()=>{t(o),o=[]},10),c=s=>{o.includes(s)||o.push(s),r(o)};function i(s,a=[]){return new Proxy(s,{get:function(h,l){const e=Reflect.get(...arguments);return e&&typeof e=="object"&&["Array","Object"].includes(e.constructor.name)?i(e,a.concat(l)):e},set:function(h,l,e){const u=Reflect.set(...arguments),p=a.concat(l).join(".");return c(p),u},deleteProperty:function(h,l){const e=Reflect.deleteProperty(...arguments),u=a.concat(l).join(".");return c(u),e}})}return i(n)}};const T={text(n,t){n.innerText=t.innerText},value(n,t){t.value?n.value=t.value:n.value=""}};function b(n,t,o){console.groupCollapsed("updates"),Object.entries(t).forEach(([r,c])=>{const i=f.findId(n,r,!0),s=f.findId(document,r,!0);s&&i&&c.forEach(a=>{o&&console.log("setting",a,s),a in T?T[a](s,i):s.setAttribute(a,i.getAttribute(a))})}),console.groupEnd()}const w=["TEXTAREA"];function A(n,t,o){function r(e){return e=e||[],e.map(u=>u.replace(t.outlet,(p,d)=>d))}function c(e){const u=f.addId(e),p=Array.from(e.attributes).reduce((d,m)=>{const{name:y,value:x}=m,j=r(m.value.match(t.outlet));return j.length&&(d[y]=j),d},{});Object.keys(p).length&&Object.entries(p).forEach(([d,m])=>o.addProp(u,d,m))}function i(e){const u=e.parentElement,p=e.textContent.match(t.outlet);if(p&&p.length){const d=r(p);if(u&&w.includes(u.tagName)){const m=f.addId(u);o.addProp(m,"value",d)}else{const m=f.wrap(e);o.addProp(m,"text",d)}}else{const d=e.textContent.match(t.iterate);if(d&&d.length){const m=e.parentNode;d.forEach(y=>{e.parentNode.setAttribute("hp-iterate",Array.from(d).map(x=>x.replace(t.iterate,(j,P)=>P)).join(","))})}}}function s(e){e.nodeType===Node.TEXT_NODE?i(e):c(e),Array.from(e.childNodes).forEach(s)}const a=f.getShadow(n),h=t.cleanup||[];Array.from(a.childNodes).forEach(s);let l=a.innerHTML;return h.forEach(({search:e,replace:u})=>{l=l.replace(e,u)}),l}var v={outlet:/<%=\s*([^<% ]+)\s*%>/gm,iterate:/<%\s*(.*).forEach\s*\(/gm,cleanup:[{search:/%&gt;/g,replace:"%>"},{search:/&lt;%/g,replace:"<%"},{search:/=&gt;/g,replace:"=>"}]},I={create(){const n={};return{stash:n,addProp(t,o,r){const c=n[t];c?c[o]=r:n[t]={[o]:r}},find(t){return Object.entries(n).reduce((o,[r,c])=>{const i=Object.keys(c).filter(s=>t.some(a=>c[s].includes(a)));return i.length&&(o[r]=i),o},{})}}}},N={parsers:{ejs:v},app({template:n,data:t,parser:o,render:r,trace:c}){const i=I.create(),s=A(n,o,i),a=E.create(t,function(h){const l=f.getShadow(r(s,a)),e=i.find(h),u=new Date().getTime();if(c&&(console.group("changed:",h),console.log("needs patched:",e),console.log("vDom:",l)),b(l,e,c),c){const p=new Date().getTime();console.log("re-render took:",p-u,"ms"),console.groupEnd()}});return c&&console.log(i.stash),{data:a,template:s,store:i}}};export{N as default};
//# sourceMappingURL=hot-plate.esm.min.js.map
