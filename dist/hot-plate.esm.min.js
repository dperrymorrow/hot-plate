const h="hp-live",A="hp-id",T="|",N="fn";var s={random(){const e=Date.now();return Math.round(Math.random()*(9999999999999-e)+e).toString(36)},debounce(e,n=0){let o=null;return function(){const a=()=>e.apply(this,arguments);o&&clearTimeout(o),o=setTimeout(a,n)}},getShadow(e){const n=document.createElement("div");return n.innerHTML=e,n},setAttrTrigger(e,n,o){e.setAttribute(A,this.random()),o=o.map(r=>r.endsWith(")")?N:r).join(",");const a=e.getAttribute(h)?e.getAttribute(h).split(T):[];e.setAttribute(h,a.concat(`${n}:${o}`).join(T))},attrQuery:e=>e.map(n=>`[${h}*=":${n}"]`).concat(`[${h}*=":*"]`).join(),getMatch:e=>document.querySelector(`[${A}="${e.getAttribute(A)}"]`)},j={create(e,n){let o=[];const a=s.debounce(()=>{n(o),o=[]},10),r=u=>{o.includes(u)||o.push(u),a(o)};function p(u,d=[]){return new Proxy(u,{get:function(m,t){const c=Reflect.get(...arguments);return c&&typeof c=="object"&&["Array","Object"].includes(c.constructor.name)?p(c,d.concat(t)):c},set:function(m,t,c){const l=Reflect.set(...arguments),i=d.concat(t).join(".");return r(i),l},deleteProperty:function(m,t){const c=Reflect.deleteProperty(...arguments),l=d.concat(t).join(".");return r(l),c}})}return p(e)}};function y(e,n,o){e.querySelectorAll(s.attrQuery(n)).forEach(a=>{const r=s.getMatch(a),p=s.hotAttrs(r);o&&(console.log("patching attributes:",p),console.log(r)),Object.keys(p).forEach(u=>{u==="value"?r.value=a.value:r.setAttribute(u,a.getAttribute(u))})}),e.querySelectorAll(s.textQuery(n)).forEach(a=>{const r=s.getMatch(a);o&&(console.log("patching text:",r.getAttribute("hp-text")),console.log(r)),r&&(r.innerText=a.innerText)})}const v=["TEXTAREA"];function x(e,n){function o(t){return t=t||[],t.map(c=>c.replace(n.outlet,(l,i)=>i))}function a(t){const c=Array.from(t.attributes).reduce((l,i)=>{const{name:f,value:b}=i,g=o(i.value.match(n.outlet));return g.length&&(l[f]=g),l},{});Object.keys(c).length&&Object.entries(c).forEach(([l,i])=>{s.setAttrTrigger(t,l,i)})}function r(t){const c=t.parentElement,l=t.textContent.match(n.outlet);if(l&&l.length){const i=o(l);if(c&&v.includes(c.tagName))s.setAttrTrigger(c,"value",i);else{const f=document.createElement("span");s.setAttrTrigger(f,"text",i),t.parentNode.insertBefore(f,t),f.append(t)}}else{const i=t.textContent.match(n.iterate);if(i&&i.length){const f=t.parentNode;t.parentNode.setAttribute("hp-id",s.random()),i.forEach(b=>{t.parentNode.setAttribute("hp-iterate",Array.from(i).map(g=>g.replace(n.iterate,(w,E)=>E)).join(","))})}}}function p(t){t.nodeType===Node.TEXT_NODE?r(t):a(t),Array.from(t.childNodes).forEach(p)}const u=s.getShadow(e),d=n.cleanup||[];Array.from(u.childNodes).forEach(p);let m=u.innerHTML;return d.forEach(({search:t,replace:c})=>{m=m.replace(t,c)}),m}var S={parse(e,n){return x(e,n)},app({template:e,data:n,parser:o,render:a,trace:r}){const p=this.parse(e,o,store),u=j.create(n,function(d){const m=s.getShadow(a(p,u)),t=new Date().getTime();if(r&&(console.group("changed:",d),console.log("vDom",m)),y(m,d,r),r){const c=new Date().getTime();console.log("re-render took:",c-t,"ms"),console.groupEnd()}});return{data:u,template:p}}};export{S as default};
//# sourceMappingURL=hot-plate.esm.min.js.map
